
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VCBR Wallet DApp</title>
  <script src="ethers.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 30px; max-width: 600px; margin: auto; }
    input, button { padding: 10px; margin: 8px 0; width: 100%; }
    button { background-color: #008CBA; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #006f9b; }
    hr { margin: 20px 0; }
  </style>
</head>
<body>
  <script>
    const allowedPassword = "vcbradmin2024";
    function checkAccess() {
      const pass = prompt("Nh·∫≠p m·∫≠t kh·∫©u truy c·∫≠p:");
      if (pass !== allowedPassword) {
        alert("Sai m·∫≠t kh·∫©u. Truy c·∫≠p b·ªã t·ª´ ch·ªëi.");
        document.body.innerHTML = "<h2>‚ùå Truy c·∫≠p b·ªã t·ª´ ch·ªëi</h2>";
      }
    }
    window.onload = checkAccess;
  </script>

  <h2>üíº V√≠ VCBR (Giao d·ªãch n·ªôi b·ªô)</h2>
  <button onclick="connectWallet()">üîå K·∫øt n·ªëi MetaMask</button>
  <p><strong>V√≠ ƒëang d√πng:</strong> <span id="walletAddress">Ch∆∞a k·∫øt n·ªëi</span></p>
  <p><strong>S·ªë d∆∞ VCBR:</strong> <span id="vcbrBalance">0</span></p>
  <p><strong>S·ªë d∆∞ ETH:</strong> <span id="ethBalance">0</span> ETH</p>

  <hr>
  <h3>üöÄ G·ª≠i VCBR Token</h3>
  <input type="text" id="vcbrReceiver" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n VCBR" />
  <input type="number" id="vcbrAmount" placeholder="S·ªë l∆∞·ª£ng VCBR mu·ªën g·ª≠i" />
  <button onclick="transferVCBR()">G·ª≠i VCBR</button>

  <hr>
  <h3>üí∏ G·ª≠i ETH</h3>
  <input type="text" id="ethReceiver" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n ETH" />
  <input type="number" id="ethAmount" placeholder="S·ªë ETH mu·ªën g·ª≠i (VD: 0.1)" />
  <button onclick="transferETH()">G·ª≠i ETH</button>

  <script>
      const contractAddress = "0x2Cb8296061f72769C6e3c218ddBeFD96f54CedBc";
    const abi = [
      "function name() view returns (string)",
      "function symbol() view returns (string)",
      "function decimals() view returns (uint8)",
      "function balanceOf(address) view returns (uint256)",
      "function transfer(address to, uint256 amount) returns (bool)"
    ];

    let provider, signer, vcbr;

    async function connectWallet() {
      if (!window.ethereum) return alert("C√†i MetaMask tr∆∞·ªõc nh√©!");

      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      const address = await signer.getAddress();
      document.getElementById("walletAddress").innerText = address;

      vcbr = new ethers.Contract(contractAddress, abi, signer);
      updateBalances(address);
    }

    async function updateBalances(address) {
      const ethBal = await provider.getBalance(address);
      document.getElementById("ethBalance").innerText = ethers.utils.formatEther(ethBal);

      const tokenBal = await vcbr.balanceOf(address);
      const decimals = await vcbr.decimals();
      document.getElementById("vcbrBalance").innerText = ethers.utils.formatUnits(tokenBal, decimals);
    }

    async function transferVCBR() {
      const to = document.getElementById("vcbrReceiver").value;
      const amount = document.getElementById("vcbrAmount").value;
      const decimals = await vcbr.decimals();
      const parsedAmount = ethers.utils.parseUnits(amount, decimals);
      const tx = await vcbr.transfer(to, parsedAmount);
      await tx.wait();
      alert("G·ª≠i VCBR th√†nh c√¥ng!");
      const address = await signer.getAddress();
      updateBalances(address);
    }

    async function transferETH() {
      const to = document.getElementById("ethReceiver").value;
      const amount = document.getElementById("ethAmount").value;
      const tx = await signer.sendTransaction({ to, value: ethers.utils.parseEther(amount) });
      await tx.wait();
      alert("G·ª≠i ETH th√†nh c√¥ng!");
      const address = await signer.getAddress();
      updateBalances(address);
    }
  </script>
</body>
</html>
